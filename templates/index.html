<!DOCTYPE html>
<html>
<head>
    <title>Interactieve Luchtvaart Routekaart (OpenAIP)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 100vh; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        const map = L.map('map').setView([51.5012, 3.7597], 7);

        const apiKey = "a4ae995451d331c23b5a6c7662a4cd7a";  // OpenAIP API-key

        L.tileLayer(`https://api.tiles.openaip.net/api/data/openaip/{z}/{x}/{y}.png?apiKey=${apiKey}`, {
            attribution: '&copy; <a href="https://www.openaip.net">OpenAIP contributors</a>',
            maxZoom: 14,
            minZoom: 6,
            subdomains: ['a', 'b', 'c'],
        }).addTo(map);

        fetch('/route', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            data.forEach(segment => {
                if (segment.error) {
                    console.error(`Error for segment ${segment.start.name} to ${segment.end.name}: ${segment.error}`);
                    return;
                }

                const startCoords = segment.start.location.split(',').map(Number);
                const endCoords = segment.end.location.split(',').map(Number);

                L.polyline([startCoords, endCoords], { color: segment.color, weight: 3, opacity: 0.8 })
                    .addTo(map)
                    .bindPopup(`
                        <strong>Van:</strong> ${segment.start.name}<br>
                        <strong>Tot:</strong> ${segment.end.name}<br>
                        <strong>Cloud Base:</strong> ${segment.cloud_base} m<br>
                        <strong>Kleur:</strong> ${segment.color}
                    `);
            });
        })
        .catch(err => console.error('Fout bij ophalen van routegegevens:', err));
    </script>
</body>
</html>
